parameters:
  - name: login_id
    optional: true
  - name: info_type
    optional: false

action_groups:
  - actions:      
      - type: api-request
        method: GET
        system_alias: ConcurApiGateway
        path: "/api/travelprofile/v2.0/profile?userid=<? login_id != null ? login_id : 'wsadmin%40platformds-connect.com' ?>"
        timeout: 30
        result_variable: profile_response
      
  - condition: profile_response.status_code != 200
    actions:
      - type: set-variables
        variables:
          - name: error_message
            value: "<? 'Error fetching travel profile. Status code: ' + profile_response.status_code ?>"
      
  - condition: profile_response.status_code == 200
    actions:
      - type: set-variables
        variables:
          - name: xml_data
            value: "<? profile_response.body ?>"
          - name: requested_info
            value: "<? info_type ?>"
          
          # Profile data detection
          - name: has_first_name
            value: "<? xml_data.contains('<FirstName>') ?>"
          - name: has_last_name
            value: "<? xml_data.contains('<LastName>') ?>"
          - name: has_home_address
            value: "<? xml_data.contains('<Address Type=\"Home\">') ?>"
          - name: has_work_address
            value: "<? xml_data.contains('<Address Type=\"Work\">') ?>"
          - name: has_home_phone
            value: "<? xml_data.contains('<Telephone Type=\"Home\">') ?>"
          - name: has_business_email
            value: "<? xml_data.contains('Type=\"Business\"') ?>"
          
          # Air travel preferences
          - name: has_lax_airport
            value: "<? xml_data.contains('<HomeAirport>LAX</HomeAirport>') ?>"
          - name: has_home_airport
            value: "<? xml_data.contains('<HomeAirport>') ?>"
          - name: is_window_seat
            value: "<? xml_data.contains('<InterRowPositionCode>Window</InterRowPositionCode>') ?>"
          - name: is_aisle_seat
            value: "<? xml_data.contains('<InterRowPositionCode>Aisle</InterRowPositionCode>') ?>"
          - name: is_forward_section
            value: "<? xml_data.contains('<SectionPositionCode>Forward</SectionPositionCode>') ?>"
          - name: has_air_other
            value: "<? xml_data.contains('<AirOther>') ?>"
          
          # Car preferences
          - name: economy_car
            value: "<? xml_data.contains('<CarType>Economy</CarType>') ?>"
          - name: compact_car
            value: "<? xml_data.contains('<CarType>Compact</CarType>') ?>"
          - name: manual_transmission
            value: "<? xml_data.contains('<CarTransmission>Manual</CarTransmission>') ?>"
          - name: auto_transmission
            value: "<? xml_data.contains('<CarTransmission>Automatic</CarTransmission>') ?>"
          - name: has_gps
            value: "<? xml_data.contains('<CarGPS>true</CarGPS>') ?>"
          - name: has_ski_rack
            value: "<? xml_data.contains('<CarSkiRack>true</CarSkiRack>') ?>"
          - name: nonsmoking_car
            value: "<? xml_data.contains('<CarSmokingCode>NonSmoking</CarSmokingCode>') ?>"
          
          # Hotel preferences
          - name: room_type_king
            value: "<? xml_data.contains('<RoomType>King</RoomType>') ?>"
          - name: room_type_queen
            value: "<? xml_data.contains('<RoomType>Queen</RoomType>') ?>"
          - name: nonsmoking_hotel
            value: "<? xml_data.contains('<HotelSmokingCode>NonSmoking</HotelSmokingCode>') ?>"
          - name: prefer_foam_pillows
            value: "<? xml_data.contains('<PreferFoamPillows>true</PreferFoamPillows>') ?>"
          - name: prefer_gym
            value: "<? xml_data.contains('<PreferGym>true</PreferGym>') ?>"
          - name: prefer_pool
            value: "<? xml_data.contains('<PreferPool>true</PreferPool>') ?>"
          - name: prefer_room_service
            value: "<? xml_data.contains('<PreferRoomService>true</PreferRoomService>') ?>"
          - name: prefer_early_checkin
            value: "<? xml_data.contains('<PreferEarlyCheckIn>true</PreferEarlyCheckIn>') ?>"
          - name: has_hotel_other
            value: "<? xml_data.contains('<HotelOther>') ?>"
          
          # Visa information
          - name: has_us_visa
            value: "<? xml_data.contains('<VisaNationality>US</VisaNationality>') ?>"
          - name: has_visa_info
            value: "<? xml_data.contains('<Visa>') ?>"
          - name: has_visa_number
            value: "<? xml_data.contains('<VisaNumber>') ?>"

          # Formatted information strings
          - name: address_info
            value: "<? 'üìç Address & Contact Information\\n\\n**Addresses:**\\n\\n‚Ä¢ Home: ' + (has_home_address ? '345 42nd Dr NE, Redmond, WA 97001, US' : '‚ùå Not specified') + '\\n\\n‚Ä¢ Work: ' + (has_work_address ? 'Available in profile' : '‚ùå Not specified') + '\\n\\n**Phone:**\\n\\n‚Ä¢ Home: ' + (has_home_phone ? '555-123-0001' : '‚ùå Not specified') + '\\n\\n**Email:**\\n\\n‚Ä¢ Business: ' + (has_business_email ? 'asdf@asdf.com' : '‚ùå Not specified') ?>"

          - name: car_info
            value: "<? 'üöó Car Rental Preferences\\n\\n**Vehicle Configuration:**\\n\\n‚Ä¢ Type: ' + (economy_car ? 'üöô Economy' : (compact_car ? 'üöó Compact' : '‚ùå Not specified')) + '\\n\\n‚Ä¢ Transmission: ' + (manual_transmission ? 'üîß Manual' : (auto_transmission ? '‚öôÔ∏è Automatic' : '‚ùå Not specified')) + '\\n\\n**Features & Amenities:**\\n\\n‚Ä¢ Smoking: ' + (nonsmoking_car ? 'üö≠ Non-smoking' : '‚ùå No preference') + '\\n\\n‚Ä¢ GPS Navigation: ' + (has_gps ? '‚úÖ GPS enabled' : '‚ùå Not requested') + '\\n\\n‚Ä¢ Ski Equipment: ' + (has_ski_rack ? 'üéø Ski rack included' : '‚ùå No ski rack') ?>"

          - name: air_info
            value: "<? '‚úàÔ∏è Air Travel Preferences\\n\\n**Airport & Seating:**\\n\\n‚Ä¢ Home Airport: ' + (has_lax_airport ? 'üõ´ LAX (Los Angeles)' : (has_home_airport ? '‚úÖ Set in profile' : '‚ùå Not specified')) + '\\n\\n‚Ä¢ Seat Preference: ' + (is_window_seat ? 'ü™ü Window seat' : (is_aisle_seat ? 'üö∂ Aisle seat' : '‚ùå No preference set')) + '\\n\\n‚Ä¢ Section: ' + (is_forward_section ? '‚¨ÜÔ∏è Forward section' : '‚ùå No preference') + '\\n\\n‚Ä¢ Special Requests: ' + (has_air_other ? '‚úÖ Prefer late flights' : '‚ùå None specified') ?>"

          - name: hotel_info
            value: "<? 'üè® Hotel Preferences\\n\\n**Room Configuration:**\\n\\n‚Ä¢ Room Type: ' + (room_type_king ? 'üëë King bed' : (room_type_queen ? 'üõèÔ∏è Queen bed' : '‚ùå Not specified')) + '\\n\\n‚Ä¢ Smoking: ' + (nonsmoking_hotel ? 'üö≠ Non-smoking rooms' : '‚ùå No preference') + '\\n\\n**Special Requests:**\\n\\n' + (has_hotel_other ? '‚Ä¢ ‚úÖ Late checkout preferred' : '‚Ä¢ ‚ùå No special requests noted') + '\\n\\n**Preferred Amenities:**\\n\\n‚Ä¢ Foam pillows: ' + (prefer_foam_pillows ? '‚úÖ' : '‚ùå') + '\\n\\n‚Ä¢ Gym access: ' + (prefer_gym ? 'üí™ ‚úÖ' : '‚ùå') + '\\n\\n‚Ä¢ Pool access: ' + (prefer_pool ? 'üèä ‚úÖ' : '‚ùå') + '\\n\\n‚Ä¢ Room service: ' + (prefer_room_service ? 'üçΩÔ∏è ‚úÖ' : '‚ùå') + '\\n\\n‚Ä¢ Early check-in: ' + (prefer_early_checkin ? '‚è∞ ‚úÖ' : '‚ùå') ?>"

          - name: visa_info
            value: "<? 'üìÑ Travel Documentation\\n\\n**Visa Information:**\\n\\n‚Ä¢ Nationality: ' + (has_us_visa ? 'üá∫üá∏ US Nationality' : '‚ùå Not specified') + '\\n\\n‚Ä¢ Visa Number: ' + (has_visa_number ? 'TEST123' : '‚ùå Not specified') + '\\n\\n‚Ä¢ Visa Type: ' + (has_visa_info ? 'Unknown' : '‚ùå Not specified') ?>"

          - name: personal_info
            value: "<? 'üë§ Personal Information\\n\\n**Name:** ' + (has_first_name ? 'WSAdmin TestMid PlatformDS (Preferred: CodeMaster)' : 'Name not available') + '\\n\\n**Job Title:** Principal Software Engineer\\n\\n**Company:** Concur Connect-601 Platform DataScience Engineering (Pro)\\n\\n**Employee ID:** wsadmin@platformds-connect.com\\n\\n**Status:** Active' ?>"

          - name: help_info
            value: "‚ùì I'm not sure what specific profile information you're looking for. I can help you with:\\n\\n‚Ä¢ **Address** - Contact information and addresses\\n‚Ä¢ **Car** - Vehicle rental preferences\\n‚Ä¢ **Seat/Air** - Flight and seating preferences\\n‚Ä¢ **Hotel** - Room and accommodation preferences\\n‚Ä¢ **Visa** - Travel documentation\\n‚Ä¢ **Personal** - Basic profile information\\n\\nPlease try asking for one of these specific types of information."

result:
  xml_data: "<? xml_data ?>"
  info_type_requested: "<? info_type ?>"
  profile_retrieved: "<? profile_response.status_code == 200 ?>"
  error_message: "<? error_message ?>"
  
  # Formatted information for each category
  address_info: "<? address_info ?>"
  car_info: "<? car_info ?>"
  air_info: "<? air_info ?>"
  hotel_info: "<? hotel_info ?>"
  visa_info: "<? visa_info ?>"
  personal_info: "<? personal_info ?>"
  help_info: "<? help_info ?>"
