parameters:
  - name: from_location
  - name: to_location
  - name: departure_date
  - name: return_date
action_groups:
  - actions:
      - type: set-variables
        variables:
          - name: estimation_request
            value: "Fetching cost estimation for the following trip : \n From: <? from_location ?> \n To: <? to_location ?> \n Departure Date: <? departure_date ?> \n Return Date: <? return_date ?>"
      - type: message
        message:
          type: text
          content: "<? estimation_request ?>"
      - type: set-variables
        variables:
          - name: estimation_result
            value: {
              "status_code": 200,
              "body": {
                "id": 'ff88c2b6-cea4-47cb-b28d-edb3d3d33b2b',
                "name": 'Trip cost estimation from <? from_location ?> to <? to_location ?> on <? departure_date ?> to <? return_date ?>',
                "explanation": "Here is the cost estimate for a trip (Airfare, Lodging, Ground Transportation) from <? from_location ?> to <? to_location ?> on <? departure_date ?> to <? return_date ?> with the booking date of 2024-03-18:\n\nEstimate Service Base Cost:\n- Airfare: The base cost for a round-trip flight from Barcelona to Paris is typically around 200 EUR. This is based on average prices for tickets booked in advance.\n- Lodging: A mid-range hotel in Paris costs around 150 EUR per night. For the number of nights, this would be 150 (1*150) EUR.\n- Ground Transportation: Taxi fares in Paris are relatively expensive, with an average cost of around 50 EUR for a trip within the city. Assuming two taxi trips for the duration of the trip, this would be 100 (2*50) EUR.\n\nReturn Final Estimate:\n\n```\nCURRENCY: EUR\nAIRFARE: 200.0\nLODGING: 150.0\nGROUND_TRANSPORTATION: 100.0\nTOTAL: 450.0\n```",
                "startDate": "2024-06-09",
                "endDate": "2024-06-10",
                "startLocation": {
                  "id": "ED0DE44F82DA435CBAFDE50FF9330BFD",
                  "countryCode": "ES",
                  "countryName": "SPAIN",
                  "city": "<? from_location ?>",
                  "name": "<? from_location ?>",
                  "locationCode": "ESBCN"
                },
                "endLocation": {
                  "id": "3E114E21BFF94BF2BCEC785C088434D3",
                  "countryCode": "FR",
                  "countryName": "FRANCE",
                  "countrySubDivisionCode": "FR-75",
                  "city": "<? to_location ?>",
                  "iataCode": "PAR",
                  "name": "<? to_location ?>",
                  "locationCode": "FRPAR"
                },
                "estimatedTotalAmount": {
                  "value": 450.0,
                  "currency": "EUR"
                },
                "services": [
                  {
                    "service": "AIRFARE",
                    "startDate": "<? departure_date ?>",
                    "endDate": "<? return_date ?>",
                    "startLocation": {
                      "id": "ED0DE44F82DA435CBAFDE50FF9330BFD",
                      "countryCode": "ES",
                      "countryName": "SPAIN",
                      "city": "<? from_location ?>",
                      "name": "Barcelona",
                      "locationCode": "ESBCN"
                    },
                    "endLocation": {
                      "id": "3E114E21BFF94BF2BCEC785C088434D3",
                      "countryCode": "FR",
                      "countryName": "FRANCE",
                      "countrySubDivisionCode": "FR-75",
                      "city": "<? to_location ?>",
                      "iataCode": "PAR",
                      "name": "<? to_location ?>",
                      "locationCode": "FRPAR"
                    },
                    "estimatedTransactionAmount": {
                      "value": 200.0,
                      "currency": "EUR"
                    },
                    "explanation": "The base cost for a round-trip flight from <? from_location ?> to <? to_location ?> is typically around 200 EUR. This is based on average prices for tickets booked in advance.",
                    "criteria": [
                      "rt"
                    ]
                  },
                  {
                    "service": "LODGING",
                    "startDate": "2024-06-09",
                    "endDate": "2024-06-10",
                    "endLocation": {
                      "id": "3E114E21BFF94BF2BCEC785C088434D3",
                      "countryCode": "FR",
                      "countryName": "FRANCE",
                      "countrySubDivisionCode": "FR-75",
                      "city": "<? to_location ?>",
                      "iataCode": "PAR",
                      "name": "<? to_location ?>",
                      "locationCode": "FRPAR"
                    },
                    "estimatedTransactionAmount": {
                      "value": 150.0,
                      "currency": "EUR"
                    },
                    "explanation": "A mid-range hotel in <? to_location ?> costs around 150 EUR per night. For the number of nights, this would be 150 (1*150) EUR.",
                    "criteria": []
                  },
                  {
                    "service": "GROUND_TRANSPORTATION",
                    "startDate": "2024-06-09",
                    "endDate": "2024-06-10",
                    "endLocation": {
                      "id": "3E114E21BFF94BF2BCEC785C088434D3",
                      "countryCode": "FR",
                      "countryName": "FRANCE",
                      "countrySubDivisionCode": "FR-75",
                      "city": "<? to_location ?>",
                      "iataCode": "PAR",
                      "name": "<? to_location ?>",
                      "locationCode": "FRPAR"
                    },
                    "estimatedTransactionAmount": {
                      "value": 100.0,
                      "currency": "EUR"
                    },
                    "explanation": "Taxi fares in <? to_location ?> are relatively expensive, with an average cost of around 50 EUR for a trip within the city. Assuming two taxi trips for the duration of the trip, this would be 100 (2*50) EUR.",
                    "criteria": []
                  }
                ]
              }
            }
      #- type: api-request
      #  method: GET
      #  system_alias: ConcurApiGateway
      #  path: "/travelrequest/v4/estimaterequests"
      #  body: |
      #    {
      #      "fromLocation": "{{from_location}}",
      #      "toLocation": "{{to_location}}",
      #      "departureDate": "{{departure_date}}",
      #      "returnDate": "{{return_date}}",
      #      "currencyCode": "USD"
      #    }
      #  result_variable: estimation_result
  - condition: estimation_result.status_code == 200
    actions:
      - type: set-variables
        variables:
          - name: estimation
            value: "<? estimation_result.body ?>"
      - type: dialog-function
        name: estimate/display_estimations
        parameters:
          - name: estimation
            value: "<? estimation ?>"
  - condition: estimation_result.status_code != 200
    actions:
      - type: message
        message:
          type: text
          content: "An error occurred when fetching the cost estimations. The result was: <? estimation_result ?>"


          